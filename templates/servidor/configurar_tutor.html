{% extends "servidor/servidor.html" %}
{% block content %}
<div class="card-stats max-w-lg mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-200">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">Configurar Tutoria: {{ usuario.nome }}</h2>
    
    <form action="{{ url_for('usuarios.efetivar_promocao') }}" method="POST" class="space-y-4">
        <input type="hidden" name="usuario_id" value="{{ usuario.id }}">
        
        <div>
            <label class="block font-bold text-gray-700 mb-1">Disciplina</label>
            <select name="disciplina_id" id="sel-disc" class="w-full p-2 border rounded-lg" required>
                <option value="">Selecione a disciplina...</option>
                {% for d in disciplinas %}
                <option value="{{ d.id }}">{{ d.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label class="block font-bold text-gray-700 mb-1">Professor Orientador</label>
            <select name="orientador_id" id="sel-ori" class="w-full p-2 border rounded-lg" required>
                <option value="">Escolha a disciplina primeiro</option>
            </select>
        </div>

        <div>
            <label class="block font-bold text-gray-700 mb-1">Turno de Atuação</label>
            <select name="turno" class="w-full p-2 border rounded-lg" required>
                <option value="">Selecione o turno...</option>
                <option value="Matutino">Matutino</option>
                <option value="Vespertino">Vespertino</option>
                <option value="Noturno">Noturno</option>
            </select>
        </div>

        <button type="submit" class="w-full bg-[#002E89] text-white font-bold py-3 rounded-lg hover:bg-blue-900 transition-colors mt-4">
            Finalizar Promoção
        </button>
    </form>
</div>

<div id="dados-temp" style="display: none;">
    {% for o in orientadores %}
    <span data-id="{{ o.id }}" data-nome="{{ o.nome }}" data-disc="{{ o.disciplina_orientação }}"></span>
    {% endfor %}
</div>

<script>
    const selectDisc = document.getElementById('sel-disc');
    const selectOri = document.getElementById('sel-ori');
    const dadosOrientadores = document.querySelectorAll('#dados-temp span');

    selectDisc.addEventListener('change', function() {
        const idDiscSelecionada = this.value;
        
        // Limpa o select de orientadores
        selectOri.innerHTML = '';

        if (!idDiscSelecionada) {
            const opt = document.createElement('option');
            opt.value = "";
            opt.textContent = "Escolha a disciplina primeiro";
            selectOri.appendChild(opt);
            return;
        }

        let encontrou = false;
        
        // Adiciona opção padrão
        const optDefault = document.createElement('option');
        optDefault.value = "";
        optDefault.textContent = "Selecione o orientador...";
        selectOri.appendChild(optDefault);

        // Filtra os orientadores que possuem a data-disc igual ao ID da disciplina selecionada
        dadosOrientadores.forEach(span => {
            if (span.getAttribute('data-disc') === idDiscSelecionada) {
                const opt = document.createElement('option');
                opt.value = span.getAttribute('data-id');
                opt.textContent = span.getAttribute('data-nome');
                selectOri.appendChild(opt);
                encontrou = true;
            }
        });

        if (!encontrou) {
            selectOri.innerHTML = '<option value="">Nenhum orientador para esta disciplina</option>';
        }
    });
</script>
{% endblock %}