{% extends "aluno/aluno.html" %}

{% block title %}Aluno - Marcar Tutoria{% endblock %}

{% block titulo_sessao %}
Marcar uma sessão de tutoria
{% endblock %}

{% block content %}
<form action="{{ url_for('aluno_marcar') }}" method="POST" class="bg-white border-2 border-blue-900 rounded-[32px] p-8 shadow-md max-w-4xl">
    
    <div class="mb-6">
        <label class="block font-medium mb-2">Selecione a disciplina:</label>
        <select id="id_disciplina" name="id_disciplina" onchange="filtrarSessoes()"
                class="w-full px-4 py-3 rounded-full bg-gray-100 focus:outline-none">
            <option value="">Selecione uma matéria</option>
            {% for d in disciplinas %}
                <option value="{{ d.id }}">{{ d.nome }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="sessao_container" class="hidden mt-6">
        <h3 class="text-lg font-semibold text-blue-600 mb-4">Horários Disponíveis</h3>
        <select id="id_sessao" name="id_sessao" 
                class="w-full px-4 py-3 rounded-full bg-gray-100 mb-6">
        </select>

        <div class="flex justify-end">
            <button type="submit" class="px-8 py-3 rounded-full text-white font-semibold
                           bg-gradient-to-r from-pink-600 to-blue-800">
                Confirmar Agendamento
            </button>
        </div>
    </div>
</form>

<script>
    
    const sessoesBanco = JSON.parse('{{ sessoes_js | tojson | safe }}');

    function pesquisarSessoes() {
        const discId = document.getElementById("filtro_disciplina").value;
        const container = document.getElementById("resultados_container");

        // Limpa o container com segurança
        container.innerHTML = "";

        // Verificação para evitar erro de variável nula
        if (!sessoesBanco || sessoesBanco.length === 0) {
            container.innerHTML = "<p>Nenhuma sessão disponível.</p>";
            return;
        }

        // Filtro
        const filtradas = sessoesBanco.filter(s => !discId || s.disciplina_id == discId);
        
        // Renderização...
        console.log("Sessões filtradas:", filtradas);
    }
</script>
{% endblock %}